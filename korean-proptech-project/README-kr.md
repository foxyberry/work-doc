# Rebuild Analytics (리빌드 애널리틱스)

> **재개발/재건축 사업성 분석 플랫폼** - 지도 기반 폴리곤 선택으로 정비사업 투자 의사결정 지원

---

## 프로젝트 개요

### 개요

리빌드 애널리틱스는 지도 기반의 폴리곤 선택 기능을 통해 재개발/재건축 예정지 또는 관심 지역을 직관적으로 설정하고, 해당 지역의 사업성 분석 결과를 즉시 확인할 수 있는 부동산 데이터 분석 서비스입니다.
사용자는 지도를 클릭해 경계를 지정하기만 하면, 해당 지역의 토지 조서와 사업성 분석 결과가 자동으로 생성됩니다. 각 지역에 적용되는 노후도 조건과 부동산 지수(거래건수, 노후 평균, 평균 분양가)를 기반으로 종합적인 인사이트를 제시하며, 조건을 바꿔가며 다양한 손익 시뮬레이션을 즉각적으로 확인할 수 있습니다.


### 핵심 가치

- **지도 기반 폴리곤 검색**: 지도 위에서 폴리곤을 그려 재개발/재건축 예정지를 즉시 설정
- **실시간 사업성 분석**: 토지 조서, 노후도 조건, 부동산 지수를 기반으로 종합적인 사업성 분석 결과 자동 생성
- **손익 시뮬레이션**: 다양한 조건을 조합하여 즉각적인 손익 시뮬레이션 확인 가능
- **분석 결과 다운로드**: Excel과 PDF 형태의 분석 보고서를 즉시 생성하여 제3자와 손쉽게 공유
- **AI 부동산 상담**: LangGraph 기반 챗봇으로 선택 지역의 데이터를 자연어로 질의하고 인사이트 획득
- **정비구역 데이터 통합**: 서울시 의제 처리된 정비구역, 재정비촉진지구, 도시개발구역 리스트 반영

### 제품/서비스 경쟁력

리빌드 애널리틱스는 정비사업에 특화된 데이터 분석 도구로, 사용자가 지도 상에서 관심 지역을 폴리곤 형태로 자유롭게 지정하면 해당 구역의 사업성 분석 결과를 즉시 확인할 수 있습니다. 이 과정에서 활용된 기초 데이터(토지정보, 노후도, 실거래가, 분양가 등)를 함께 제공하고, 분석 결과는 엑셀 파일로 다운로드할 수 있어, 사용자가 자체적으로 다양한 조건을 시뮬레이션하거나 외부 전문가와 쉽게 공유할 수 있도록 구성되어 있습니다.

**미래 가치 중심의 의사결정 지원**

리빌드 애널리틱스는 기존의 시세 중심 평가에서 벗어나, 미래 가치를 중심으로 의사결정을 지원하는 점에서 차별성을 갖고 있습니다. 도시 노후화가 더욱 진행될 것으로 예상되며, 지역의 가치를 판단할 때 단순히 현재의 매매가나 공시지가만으로는 충분하지 않습니다. 정비사업 가능성, 재개발 이후의 자산 가치, 비례율 등 미래 사업성을 함께 고려해야 보다 정밀한 가치 평가가 가능해집니다.

리빌드 애널리틱스는 이러한 관점을 반영해, 현재의 기초 데이터뿐 아니라 향후 개발 잠재력과 다양한 시나리오에 따른 손익 시뮬레이션을 함께 제공함으로써, 사용자가 미래 지향적인 판단을 내릴 수 있도록 돕고 있습니다.

**대상 사용자**

리빌드 애널리틱스는 전문가, 기업 투자자, 일반 투자자 모두를 위한 사업성 검토 도구로, 정보 비대칭이 심한 정비사업 분야에서 의사결정의 정확성과 효율성을 향상시키고자 합니다.

---

## Tech Stack

```
Backend       Kotlin, Java 17, Spring Boot 3.3.2, FastAPI
AI/Agent      LangGraph, LangChain, OpenAI GPT-4o, MCP (Model Context Protocol)
Data          Elasticsearch 8.8, Redis, PostgreSQL
Auth          Keycloak 23.0, OAuth2, JWT, RBAC
DevOps        Docker, GitHub Actions, Self-hosted Runner
Document      Apache POI (Excel), OpenHTMLtoPDF, iText7
```

---

## AI 상담 서비스 (LangGraph)

### 개요

LangGraph 기반의 부동산 상담 챗봇입니다. 사용자가 지도에서 선택한 지역의 토지/건물 데이터를 기반으로 자연어 질의에 응답합니다.

### 주요 기능

- **컨텍스트 기반 상담**: 사용자가 선택한 폴리곤 영역의 데이터를 세션에 유지하며 멀티턴 대화 지원
- **도구 기반 데이터 조회**: LLM이 필요한 정보를 판단하여 Spring API를 호출하고 결과를 해석
- **실시간 스트리밍**: SSE(Server-Sent Events) 기반 응답 스트리밍으로 빠른 사용자 경험 제공
- **후속 질문 제안**: 대화 맥락에 맞는 관련 질문을 자동으로 추천

### 아키텍처

```
┌─────────────────────────────────────────────────────────────────┐
│                        LangGraph Agent                          │
│  ┌───────────────┐  ┌───────────────┐  ┌───────────────────┐   │
│  │  Agent Node   │──│  Tool Node    │──│  Checkpointer     │   │
│  │  (GPT-4o)     │  │  (API 호출)   │  │  (Redis/Memory)   │   │
│  └───────────────┘  └───────────────┘  └───────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
         │                    │
         ▼                    ▼
┌─────────────────┐  ┌─────────────────────────────────────────┐
│  FastAPI Server │  │            Spring Boot API              │
│  (SSE Streaming)│  │  토지요약, 건물정보, 노후도, 사업성분석   │
└─────────────────┘  └─────────────────────────────────────────┘
```

### 제공 도구 (Tools)

| 도구 | 설명 |
|------|------|
| `get_land_summary` | 선택 영역의 토지 요약 정보 조회 |
| `get_land_summary_analysis` | 사업성 분석 결과 조회 |
| `get_building_info` | 건물 상세 정보 조회 |
| `check_aging_building` | 노후 건축물 현황 확인 |
| `get_jibun_report` | 지번별 상세 보고서 조회 |
| `convert_units` | 면적/가격 단위 변환 |

### MCP (Model Context Protocol) 연동

Claude Desktop 및 기타 MCP 클라이언트에서 직접 토지 데이터를 조회할 수 있도록 MCP 서버를 제공합니다. 동일한 API 클라이언트 코드를 공유하여 일관된 데이터 접근을 보장합니다.

---

## 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────────┐
│                        Client Applications                          │
│            Web App (Next.js)  │  Claude Desktop (MCP)               │
└─────────────────────────────────────────────────────────────────────┘
                                   │
                                   ▼
┌─────────────────────────────────────────────────────────────────────┐
│                       Application Layer                             │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────────┐ │
│  │  Spring Boot    │  │  LangGraph      │  │  MCP Server         │ │
│  │  REST API       │◄─│  AI Chatbot     │  │  Claude 연동        │ │
│  └─────────────────┘  └─────────────────┘  └─────────────────────┘ │
└─────────────────────────────────────────────────────────────────────┘
                                   │
                                   ▼
┌─────────────────────────────────────────────────────────────────────┐
│                        Common Modules                               │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐  │
│  │csv-reader│ │    es    │ │generator │ │  model   │ │  redis   │  │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘  │
└─────────────────────────────────────────────────────────────────────┘
                                   │
                                   ▼
┌─────────────────────────────────────────────────────────────────────┐
│                       Infrastructure Layer                          │
│  ┌───────────────────────────┐  ┌───────────────────────────────┐  │
│  │       ELK Stack           │  │       Auth Stack              │  │
│  │  ES │ Logstash │ Kibana   │  │  Keycloak │ PostgreSQL        │  │
│  └───────────────────────────┘  └───────────────────────────────┘  │
│  ┌─────────────────┐  ┌───────────────────────────────────────┐    │
│  │      Redis      │  │       External APIs                   │    │
│  │  (Cache/Session)│  │  OpenAI │ Map API │ Government Data   │    │
│  └─────────────────┘  └───────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 보고서 생성

분석 결과를 다양한 형식으로 다운로드할 수 있습니다.

### Excel 보고서

| 시트 | 포함 내용 |
|------|----------|
| 토지 요약 | 필지수, 면적, 용적률, 노후화율 등 종합 정보 |
| 건물 정보 | 건물별 상세 정보 (구조, 층수, 사용승인일 등) |
| 사업성 분석 | 개발수익, 총사업비, 순수익, 비례율 시뮬레이션 |
| 노후도 조건 | 노후 건축물 현황 및 판정 결과 |

### PDF 보고서

- HTML 템플릿 기반 고품질 문서 생성
- 차트 및 그래프 포함 (파이차트, 바차트, 라인차트)
- QR 코드 삽입으로 원본 데이터 접근 지원

---

## 사용자 기능

### 검색 히스토리

- 사용자별 검색 이력 자동 저장
- 이전 검색 지역 재조회 지원
- 검색 조건 (폴리곤, 관계 타입) 복원

### 즐겨찾기

- 관심 지역 저장 및 관리
- 저장된 지역 빠른 접근

### 사용 통계

- 일별/기간별 서비스 사용량 집계
- 관리자 대시보드에서 통계 조회

---

## 프로젝트 성과

| 항목 | 수치 |
|------|------|
| 총 모듈 수 | 8개 (멀티모듈 Gradle) |
| API 엔드포인트 | 30개 이상 |
| 처리 데이터 | 정부 공공데이터 10종 이상 |
| Docker 서비스 | 7개 (API, AI, Auth, ES, Redis, ELK, MCP) |
| 코드 라인 | 35,000줄 이상 |
| 개발/운영 기간 | 1년 이상 (현재 운영 중) |

---

## 적용 기술

### Backend

| 기술 | 적용 내용 |
|------|----------|
| **Spring Boot 3.3** | REST API 서버, 멀티모듈 아키텍처 |
| **Kotlin** | Null Safety, Data Class, Coroutines |
| **Spring Security** | OAuth2 Resource Server, JWT 검증 |
| **Spring Data Elasticsearch** | Repository 패턴, Bulk Upsert |

### AI / Agent

| 기술 | 적용 내용 |
|------|----------|
| **LangGraph** | 상태 기반 에이전트, Tool Calling, Checkpointer |
| **LangChain** | 프롬프트 관리, LLM 추상화 |
| **OpenAI GPT-4o** | 부동산 상담 응답 생성 |
| **MCP** | Claude Desktop 연동, 외부 클라이언트 지원 |
| **LangSmith** | LLM 호출 추적, 디버깅 |

### Data

| 기술 | 적용 내용 |
|------|----------|
| **Elasticsearch 8.8** | 문서 저장, 전문 검색, GeoShape Query |
| **GeoShape Query** | WKT 형식 폴리곤으로 필지/건물 경계 검색 |
| **ETL Pipeline** | 정부 CSV/SHP 데이터 파싱 및 Bulk 인덱싱 |
| **Redis** | API 응답 캐싱, AI 세션 상태 관리 |

### Auth / Security

| 기술 | 적용 내용 |
|------|----------|
| **Keycloak** | IdP, OAuth2/OIDC, 사용자 관리 UI |
| **RBAC** | guest, user, super_user, admin 4단계 역할 |
| **JWT** | 토큰 기반 인증, Python/Kotlin 간 공유 |

### DevOps

| 기술 | 적용 내용 |
|------|----------|
| **Docker Compose** | 멀티 컨테이너 오케스트레이션 |
| **GitHub Actions** | CI/CD, 태그 기반 자동 배포 |
| **Self-hosted Runner** | 개인 서버 배포 자동화 |
| **SSL/TLS** | Let's Encrypt 인증서, HTTPS |

### Monitoring

| 기술 | 적용 내용 |
|------|----------|
| **ELK Stack** | 로그 수집/저장/시각화 |
| **Structured Logging** | Logstash Logback Encoder, JSON 로그 |
| **Kibana** | 환경별 인덱스 패턴, 대시보드 |

### Document Generation

| 기술 | 적용 내용 |
|------|----------|
| **Apache POI** | Excel 보고서 생성 |
| **OpenHTMLtoPDF** | HTML → PDF 변환 |
| **QuickChart** | 차트 이미지 생성 API |

---

## 데이터 분석 모델

### 지역별 시세 보정 모델

공시가격과 실제 시장 가격 사이의 간극을 한국부동산원의 아파트 매매가격지수를 활용하여 보정하는 모델을 개발했습니다.

**도입 배경:**
- 공시가격은 연 1회 산정되어 급변하는 시장 상황을 반영하지 못함
- 지역별로 상이한 가격 변동률을 포착하는 데 한계
- 같은 서울 내에서도 서초구(+17.3%)와 도봉구(-14.0%)의 극명한 격차 존재

**핵심 알고리즘:**
```
보정 가중치(W) = (1 ÷ 현실화율) × (현재 매매지수 ÷ 공시가격 기준일 매매지수)
보정 시세 = 공시가격 × W
```

**모델 특징:**
- 공시가격 이후의 순수한 시장 변동분만 보정
- 장기 누적 효과로 인한 가중치 과대 산정 방지
- 지역별 고유의 시장 흐름 반영

### 이상치 탐지 및 선형 보간

시계열 데이터(평당 분양가, 가격 히스토리 등)에서 누락된 값과 이상치를 처리하는 알고리즘을 구현했습니다.

**이상치 탐지 (Moving Average 기반):**
```
1. 데이터 양 끝에 패딩 추가 (경계 처리)
2. 윈도우 크기만큼 이동 평균 계산
3. 이동 평균 대비 80% 이상 벗어난 값을 이상치로 판정
4. 이상치는 null로 마킹
```

**선형 보간 (Polynomial Spline):**
```
1. 유효한 값만 추출하여 (index, value) 쌍 구성
2. 다항 스플라인 보간 함수 생성
3. null 값을 보간 함수로 추정하여 채움
4. 범위 외 값은 경계값으로 대체
```

**활용 분야:**
- 연도별 평당 분양가격 히스토리에서 누락 데이터 보완
- 아파트 실거래가 시계열 데이터 정제
- 차트 시각화를 위한 연속적인 데이터 생성

---

## 향후 발전 방향

- Kubernetes 마이그레이션으로 확장성 확보
- RAG(Retrieval-Augmented Generation) 도입으로 AI 분석 고도화
- 실시간 데이터 스트리밍 파이프라인 구축
- 다국어 지원 (한국어/영어)